#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "so_tcplib.h"

void error ( char *message )
{
  printf("%s\n", message );
  exit(1);
}

int main ( int argc, char *argv[] )
{

	if ( argc < 3 )
	{
		error ("Error on providing server information.\nUsage: cus-client [IP] [port]");
	}

	// Setting server hostname/IP
	char *server_host = argv[1];
	// Setting server port
	int server_port = atoi(argv[2]);
	// Input buffer
	char buffer[255];
	// Input buffer string ( needed for fgets )
	char *input;
	// Socket return
	int n = 0;

	int sock = tcpConnectSocket ( server_host, server_port );

	if ( sock < 0 )
	{
		error ( "Error on connecting to server" );
	}

	printf("Connected successfully\n");
	
	do
	{
		n = read ( sock, buffer, 255 );
		//printf("> ");
		input = fgets ( buffer, 255, stdin );
		// Writing to socket
		printf("%d\n", strlen ( buffer ));
		n = write ( sock, buffer, strlen ( buffer ) );
	}
	while ( n > 0 );

  return 0;
  
}
